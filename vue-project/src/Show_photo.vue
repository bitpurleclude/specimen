<script setup>
import { onMounted, ref, watch } from 'vue'
import url from '@/2.png'
const image_url = ref(url)
const svgData = ref("M291 430 L291 429 L290 429 L290 428 L289 428 L289 427 L288 426 L288 425 L288 425 L288 424 L288 423 L287 423 L287 422 L287 421 L286 421 L286 421 L285 421 L285 420 L284 420 L284 419 L284 419 L284 418 L284 417 L284 417 L283 417 L283 416 L283 415 L282 415 L282 414 L282 413 L281 413 L281 413 L281 412 L281 411 L280 411 L280 410 L280 409 L280 409 L280 409 L280 408 L280 407 L279 407 L279 406 L279 405 L279 405 L278 405 L278 404 L278 403 L278 402 L278 401 L277 401 L277 401 L277 400 L277 399 L277 398 L277 397 L277 397 L276 397 L276 396 L276 395 L276 395 L276 394 L275 394 L275 393 L275 393 L274 393 L273 393 L272 393 L272 393 L272 393 L271 393 L270 393 L270 394 L269 394 L268 394 L268 395 L268 395 L268 396 L267 396 L267 397 L267 397 L267 398 L267 399 L267 400 L267 401 L266 401 L265 401 L264 401 L264 401 L264 400 L263 400 L263 399 L263 398 L263 397 L262 397 L262 397 L262 396 L262 395 L262 394 L262 393 L262 393 L262 393 L262 393 L262 392 L262 391 L262 390 L262 389 L262 389 L262 388 L262 387 L262 386 L263 386 L263 385 L263 385 L263 384 L263 383 L263 382 L263 381 L263 381 L263 380 L264 380 L264 379 L264 378 L264 377 L264 377 L264 376 L264 375 L264 375 L264 374 L264 373 L264 373 L264 372 L265 372 L265 371 L265 370 L265 369 L266 369 L266 368 L266 367 L266 366 L266 365 L266 365 L266 364 L266 363 L266 362 L266 361 L266 361 L266 360 L266 359 L267 359 L267 358 L267 357 L267 357 L267 356 L267 355 L267 354 L268 354 L268 353 L268 353 L268 352 L267 352 L267 351 L267 350 L266 350 L265 350 L265 349 L264 349 L264 349 L264 349 L263 349 L263 348 L262 348 L262 347 L261 347 L261 346 L260 346 L260 345 L260 345 L260 345 L260 344 L259 344 L259 343 L259 342 L258 342 L258 341 L257 341 L257 341 L257 340 L257 339 L256 339 L256 338 L256 337 L256 337 L256 337 L256 336 L256 335 L255 335 L255 334 L255 333 L255 333 L254 333 L254 332 L254 331 L254 330 L253 330 L253 329 L253 329 L253 328 L252 328 L252 327 L252 326 L252 325 L252 325 L252 325 L252 324 L252 323 L252 322 L251 322 L251 321 L251 321 L251 320 L250 320 L250 319 L250 318 L250 317 L249 317 L249 316 L249 315 L249 314 L248 314 L248 313 L248 313 L248 312 L248 311 L248 310 L248 309 L248 309 L248 309 L248 308 L248 307 L248 306 L247 306 L247 305 L247 305 L247 304 L246 303 L246 302 L246 301 L246 301 L246 300 L245 300 L245 299 L245 298 L245 297 L245 297 L245 296 L244 296 L244 295 L244 294 L244 293 L244 293 L244 292 L244 291 L244 290 L244 289 L244 289 L244 288 L244 287 L244 286 L244 286 L244 285 L244 285 L244 284 L244 283 L244 282 L244 281 L244 281 L244 280 L244 279 L244 278 L244 277 L244 277 L244 276 L244 275 L244 274 L244 273 L244 273 L244 272 L244 271 L244 270 L244 269 L244 269 L244 268 L244 267 L244 266 L244 265 L244 265 L244 264 L244 263 L244 262 L244 261 L244 261 L244 260 L244 259 L244 258 L244 257 L244 257 L244 256 L244 255 L244 254 L244 253 L244 253 L244 252 L244 251 L244 250 L244 249 L244 249 L244 248 L244 247 L244 246 L244 245 L244 245 L244 244 L244 243 L244 242 L244 241 L244 241 L244 240 L244 239 L244 238 L244 237 L244 237 L244 236 L244 236 L244 235 L244 234 L244 233 L244 233 L245 233 L245 232 L245 231 L245 230 L246 230 L246 229 L246 229 L246 228 L246 227 L247 227 L247 226 L247 225 L247 225 L248 225 L248 224 L248 223 L248 222 L248 222 L248 221 L248 221 L248 220 L249 220 L249 219 L249 218 L249 217 L250 217 L250 217 L250 216 L250 215 L250 214 L251 214 L251 213 L251 213 L251 212 L251 211 L252 211 L252 210 L252 209 L252 209 L252 208 L252 208 L252 207 L252 206 L252 205 L253 205 L253 205 L253 204 L253 203 L253 202 L254 201 L254 201 L254 200 L255 200 L255 199 L255 198 L255 197 L255 197 L256 197 L256 196 L256 195 L256 194 L256 194 L256 193 L256 193 L257 193 L257 192 L257 191 L257 190 L258 190 L258 189 L258 189 L259 189 L259 188 L259 187 L259 186 L259 185 L260 185 L260 185 L260 184 L260 183 L260 183 L260 182 L260 181 L260 181 L260 180 L260 179 L260 178 L260 177 L260 177 L260 176 L260 175 L260 174 L260 173 L260 173 L260 172 L260 171 L260 170 L260 169 L260 169 L260 168 L260 167 L260 166 L260 165 L260 165 L260 164 L260 163 L260 162 L260 161 L260 161 L260 160 L260 159 L260 158 L260 157 L260 157 L260 156 L260 155 L260 154 L260 153 L260 153 L260 152 L260 151 L260 150 L260 150 L260 149 L260 149 L260 148 L260 147 L260 146 L260 145 L260 145 L260 144 L260 143 L260 142 L260 141 L260 141 L260 140 L260 139 L260 139 L260 138 L260 137 L260 137 L261 136 L261 135 L261 134 L261 133 L262 133 L262 133 L262 132 L263 132 L263 131 L263 130 L263 129 L263 129 L264 129 L264 128 L264 127 L264 126 L264 126 L264 125 L265 125 L266 125 L266 125 L267 125 L268 125 L268 125 L268 125 L268 126 L269 126 L270 126 L270 127 L271 127 L271 128 L272 128 L272 128 L272 129 L273 129 L274 129 L274 129 L275 129 L275 130 L276 130 L276 130 L276 131 L277 131 L277 132 L278 132 L278 133 L279 133 L279 133 L280 133 L280 134 L280 134 L280 135 L281 135 L281 136 L282 136 L282 137 L282 137 L283 137 L283 138 L283 139 L284 139 L284 140 L284 140 L284 141 L284 141 L285 141 L285 142 L286 142 L286 143 L287 143 L287 144 L288 144 L288 145 L288 145 L289 145 L289 145 L290 145 L290 146 L291 146 L292 146 L292 147 L292 147 L293 147 L294 147 L294 148 L295 148 L296 148 L296 148 L297 148 L297 147 L298 147 L298 146 L299 146 L299 145 L300 145 L300 145 L300 145 L300 144 L301 144 L302 144 L303 144 L304 143 L304 143 L305 143 L306 143 L307 143 L308 143 L308 143 L308 142 L309 142 L310 142 L311 142 L312 142 L312 141 L312 141 L313 141 L314 141 L314 141 L315 141 L316 141 L316 141 L316 140 L317 140 L318 140 L319 140 L319 139 L320 139 L320 139 L321 139 L321 138 L322 138 L323 138 L324 138 L324 138 L325 138 L325 137 L326 137 L327 137 L328 137 L328 137 L329 137 L329 137 L330 137 L331 137 L332 137 L332 137 L333 137 L334 137 L335 137 L335 136 L336 136 L336 136 L337 136 L338 136 L339 136 L339 135 L340 135 L340 135 L341 135 L341 134 L341 133 L341 133 L342 133 L342 132 L343 132 L343 131 L343 130 L343 129 L344 129 L344 129 L344 128 L344 128 L344 127 L344 126 L344 125 L345 125 L345 125 L346 125 L346 124 L347 124 L348 124 L348 123 L348 123 L349 123 L349 122 L350 122 L350 121 L351 121 L351 121 L352 120 L352 119 L352 119 L352 118 L352 117 L353 117 L353 117 L354 117 L354 116 L354 115 L355 115 L355 114 L355 113 L356 113 L356 113 L356 113 L356 112 L356 111 L357 111 L357 110 L358 110 L358 109 L359 109 L359 109 L359 108 L360 108 L360 107 L360 107 L360 106 L361 106 L361 105 L362 105 L362 105 L363 105 L363 104 L364 104 L364 103 L364 103 L364 102 L365 102 L366 102 L366 103 L367 103 L367 104 L367 105 L368 105 L368 105 L368 106 L368 106 L368 107 L368 108 L368 109 L369 109 L369 109 L369 110 L369 111 L370 111 L370 112 L370 113 L371 113 L371 113 L371 114 L372 114 L372 115 L372 116 L372 117 L372 117 L372 117 L372 118 L372 119 L372 120 L372 121 L372 121 L373 121 L373 122 L373 123 L373 124 L373 125 L374 125 L374 125 L374 126 L375 126 L375 127 L375 128 L375 129 L376 129 L376 129 L376 130 L376 131 L376 132 L376 133 L376 133 L376 134 L376 135 L376 136 L376 137 L376 137 L376 137 L376 138 L376 139 L376 140 L377 140 L377 141 L377 141 L377 142 L378 142 L378 143 L378 144 L378 145 L378 145 L379 145 L379 146 L379 147 L379 148 L380 148 L380 149 L380 149 L380 150 L380 151 L380 151 L380 152 L380 153 L381 153 L381 153 L382 153 L382 154 L382 155 L383 155 L383 156 L384 156 L384 157 L384 157 L384 157 L384 158 L385 158 L385 159 L385 160 L386 160 L386 161 L387 161 L387 161 L387 162 L388 162 L388 163 L388 163 L388 164 L389 164 L389 165 L390 165 L390 165 L391 165 L391 166 L392 166 L392 167 L392 168 L392 168 L392 169 L392 169 L393 169 L393 170 L394 171 L394 172 L395 173 L395 173 L396 173 L396 174 L396 175 L396 175 L396 176 L396 177 L397 177 L397 177 L397 178 L398 178 L398 179 L398 180 L399 180 L399 181 L399 181 L400 181 L400 182 L400 183 L400 183 L400 184 L401 184 L401 185 L401 185 L402 185 L402 186 L402 187 L403 187 L403 188 L404 189 L404 189 L404 190 L404 190 L404 191 L405 192 L405 193 L406 193 L406 193 L406 194 L407 194 L407 195 L407 196 L408 196 L408 197 L408 197 L408 197 L408 198 L408 199 L409 199 L409 200 L409 201 L409 201 L410 201 L410 202 L410 203 L411 203 L411 204 L411 205 L412 205 L412 205 L412 206 L412 207 L412 207 L412 208 L412 209 L412 209 L413 209 L413 210 L413 211 L413 212 L413 213 L413 213 L413 214 L413 215 L413 216 L413 217 L414 217 L414 217 L414 218 L414 219 L414 220 L415 220 L415 221 L415 221 L415 222 L415 223 L416 223 L416 224 L416 225 L416 225 L416 226 L416 226 L416 227 L416 228 L416 229 L416 229 L416 230 L416 231 L416 232 L417 232 L417 233 L417 233 L417 234 L417 235 L417 236 L417 237 L417 237 L417 238 L417 239 L417 240 L417 241 L417 241 L417 242 L417 243 L417 244 L417 245 L417 245 L417 246 L417 247 L417 248 L416 248 L416 249 L416 249 L416 250 L416 251 L416 252 L416 253 L416 253 L416 253 L416 254 L416 255 L416 256 L416 257 L416 257 L416 258 L416 259 L416 260 L416 261 L416 261 L416 262 L416 263 L416 264 L416 265 L416 265 L416 266 L416 267 L416 268 L416 269 L416 269 L416 270 L416 271 L416 272 L416 273 L416 273 L416 274 L416 275 L416 276 L416 277 L416 277 L416 278 L416 279 L416 280 L416 281 L416 281 L416 282 L416 283 L416 284 L416 285 L416 285 L416 286 L416 287 L416 288 L416 289 L416 289 L416 290 L416 291 L416 292 L416 293 L416 293 L416 294 L416 295 L416 296 L415 296 L415 297 L415 297 L415 298 L415 299 L414 299 L414 300 L414 301 L414 301 L413 301 L413 302 L413 303 L413 304 L413 305 L413 305 L412 305 L412 306 L412 307 L412 308 L412 308 L412 309 L412 309 L412 310 L411 310 L411 311 L411 312 L411 313 L410 313 L410 313 L410 314 L410 315 L409 315 L409 316 L409 317 L408 317 L408 317 L408 318 L408 319 L408 320 L408 321 L408 321 L408 322 L408 323 L408 324 L408 325 L408 325 L408 326 L408 327 L409 327 L409 328 L409 329 L409 329 L410 329 L410 330 L410 331 L411 331 L411 332 L411 333 L412 333 L412 333 L412 334 L412 334 L412 335 L412 336 L413 336 L413 337 L413 337 L414 337 L414 338 L415 338 L415 339 L415 340 L416 340 L416 341 L416 341 L416 341 L416 342 L416 343 L417 343 L417 344 L417 345 L418 345 L418 345 L418 346 L418 347 L419 347 L419 348 L419 349 L419 349 L420 349 L420 350 L420 351 L420 352 L420 353 L420 353 L420 354 L420 355 L419 355 L419 356 L418 356 L417 356 L417 357 L416 357 L416 357 L416 357 L415 357 L414 357 L413 357 L413 357 L412 357 L412 356 L412 356 L411 356 L411 355 L410 355 L409 355 L409 354 L408 354 L408 354 L407 354 L406 354 L405 354 L404 354 L404 355 L404 355 L404 356 L404 357 L403 357 L403 358 L403 359 L403 360 L403 361 L403 361 L403 362 L403 363 L403 364 L403 365 L403 365 L403 366 L403 367 L403 368 L402 368 L402 369 L402 369 L402 370 L402 371 L402 372 L401 372 L401 373 L401 373 L401 374 L401 375 L401 376 L400 376 L400 377 L400 377 L400 378 L400 379 L400 380 L400 381 L400 381 L400 381 L400 382 L400 383 L400 384 L400 385 L400 385 L400 386 L399 386 L399 387 L399 388 L399 389 L399 389 L399 390 L399 391 L399 392 L398 392 L398 393 L398 393 L397 394 L397 395 L397 396 L396 396 L396 397 L396 397 L396 397 L396 398 L395 398 L395 399 L395 400 L394 400 L394 401 L393 401 L393 401 L393 402 L392 402 L392 403 L392 404 L392 404 L392 405 L392 405 L391 405 L391 406 L391 407 L390 407 L390 408 L390 409 L389 409 L389 409 L389 410 L389 411 L389 412 L388 412 L388 413 L388 413 L388 414 L388 415 L388 416 L388 417 L388 417 L388 417 L388 418 L388 419 L388 420 L388 421 L388 421 L388 422 L388 423 L388 424 L388 425 L387 425 L387 425 L387 426 L387 427 L387 428 L387 429 L387 429 L387 430 L387 431 L387 432 L387 433 L387 433 L387 434 L386 434 L386 435 L386 436 L291 430")
    //获取img大小
const imageSize = ref({ left: 0, top: 0, width: 0, height: 0, realWidth: 0, realHeight: 0, xScale: 1, yScale: 1 });
const imgRef = ref(null);
// 更新imgSize函数，使用imgRef元素
const imgSize = () => {
  if (imgRef.value) {
    let img = imgRef.value;
    img.onload = function () {
      imageSize.value = {
        width: img.offsetWidth,
        height: img.offsetHeight,
        realWidth: img.naturalWidth,
        realHeight: img.naturalHeight,
        xScale: img.offsetWidth / img.Width,
        yScale: img.offsetHeight / img.Height,
        left: img.offsetLeft,
        top: img.offsetTop
      };
    };
  }
};
onMounted(() => {
  imgSize();
  // 如果图片地址可能会动态改变，可以添加watch监听
  watch(
    () => image_url.value,
    () => {
      imgSize();
    },
    { immediate: true }
  );
});

</script>

<template>
  <div>
    <!-- 渲染图片 -->
    <img ref="imgRef" :src="image_url" alt="..." style="position: relative;" :width="500" :height="500"/>
    <!-- 渲染SVG，根据imageSize进行缩放和定位 -->
    <svg :width="imageSize.width" :height="imageSize.height"
      :view-box="`0 0 ${imageSize.Width} ${imageSize.Height}`" xmlns="http://www.w3.org/2000/svg"
      :style="{ position: 'absolute', left: `${imageSize.left}px`, top: `${imageSize.top}px` }">
      <g :transform="`scale(${imageSize.xScale}, ${imageSize.yScale})`">
        <path :d="svgData" stroke="black" fill="none" stroke-width="2"></path>
        <path :d="svgData" fill="black" fill-opacity="0" id="hiddenPath"></path>
      </g>
    </svg>
  </div>
</template>