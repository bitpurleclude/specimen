<script setup>
import { onMounted, ref, computed } from 'vue'
import url from '@/photo/背面（原图）.jpg'
import { SVGData } from './data/SVGData';

//图片大小获取
onMounted(() => {
  adjustImageSize();
});
const image_url = ref(url)
const svgData = ref([
  ["M243 342 L242 342 L241 342 L240 342 L240 342 L239 342 L238 342 L237 342 L236 342 L236 342 L235 342 L234 342 L233 342 L232 342 L232 342 L231 342 L231 343 L230 343 L229 343 L228 343 L228 344 L228 344 L227 344 L227 345 L226 345 L225 345 L225 345 L224 345 L224 346 L224 346 L224 347 L223 347 L223 348 L223 349 L222 349 L222 349 L222 350 L222 351 L222 352 L222 353 L222 353 L222 354 L222 355 L222 356 L221 356 L221 357 L221 357 L221 358 L221 359 L221 360 L221 361 L221 361 L221 362 L221 363 L221 364 L221 365 L221 365 L221 366 L221 367 L221 368 L221 369 L221 369 L221 370 L221 371 L221 372 L221 373 L221 373 L221 374 L221 375 L221 376 L221 377 L221 377 L221 378 L221 379 L221 380 L221 381 L221 381 L221 382 L221 383 L221 384 L220 385 L220 385 L220 386 L220 387 L220 388 L220 388 L220 389 L220 389 L220 390 L220 391 L219 391 L219 392 L219 393 L218 393 L218 393 L218 394 L217 394 L217 395 L217 396 L216 396 L216 397 L216 397 L216 398 L216 399 L216 400 L215 400 L215 401 L215 401 L215 402 L215 403 L215 404 L215 405 L215 405 L214 405 L214 406 L214 407 L214 408 L214 409 L214 409 L214 410 L214 411 L214 412 L213 413 L213 413 L213 414 L213 415 L213 416 L213 417 L213 417 L213 418 L213 419 L213 420 L213 421 L213 421 L213 422 L213 423 L213 424 L213 425 L213 425 L213 426 L213 427 L213 428 L213 429 L213 429 L213 430 L213 431 L213 432 L213 433 L214 433 L214 433 L214 434 L215 434 L215 435 L216 435 L216 435 L216 436 L217 436 L218 436 L219 436 L220 436 L220 436 L221 436 L222 436 L222 437 L223 437 L224 437 L224 437 L225 437 L226 437 L226 437 L227 437 L228 437 L228 437 L228 438 L229 438 L230 438 L230 439 L231 439 L232 439 L232 439 L232 440 L233 440 L234 440 L235 440 L236 440 L236 440 L237 440 L238 440 L238 439 L238 438 L238 437 L238 437 L239 437 L239 436 L239 435 L239 434 L239 433 L239 433 L239 432 L239 431 L239 430 L239 429 L239 429 L239 428 L239 427 L239 426 L239 425 L239 425 L239 424 L239 423 L239 422 L239 421 L239 421 L239 420 L239 419 L239 418 L239 417 L239 417 L238 417 L238 416 L238 415 L238 414 L238 413 L238 413 L238 412 L238 411 L238 410 L238 409 L238 409 L238 408 L238 407 L238 406 L238 405 L238 405 L238 404 L238 403 L238 402 L238 401 L238 401 L238 400 L238 399 L238 398 L238 397 L238 397 L238 396 L238 395 L239 395 L239 394 L239 393 L239 393 L239 392 L239 391 L239 390 L240 390 L240 389 L240 389 L240 388 L240 387 L240 387 L240 386 L240 385 L240 385 L241 385 L241 384 L241 383 L241 382 L242 381 L242 381 L242 380 L242 379 L243 379 L243 378 L243 377 L243 377 L244 377 L244 376 L244 375 L244 374 L244 374 L244 373 L244 373 L245 372 L245 371 L245 370 L245 369 L246 369 L246 369 L246 368 L247 368 L247 367 L247 366 L247 365 L248 365 L248 365 L248 364 L248 363 L248 362 L248 361 L248 361 L249 361 L249 360 L249 359 L249 358 L249 357 L249 357 L249 356 L249 355 L249 354 L249 353 L249 353 L249 352 L248 352 L248 351 L248 350 L248 349 L248 349 L248 349 L247 349 L247 348 L247 347 L246 347 L246 346 L245 346 L245 345 L244 345 L244 345 L244 344 L244 344 L243 344 L243 343 L242 343 L242 342 L241 342 L240 342 L240 342 L240 341 L239 341 L238 341 L238 341 L237 341 L236 341 L236 340 L236 340 L236 339 L235 339 L243 342"],
  ["M358 68 L357 68 L357 67 L357 66 L357 65 L356 65 L356 65 L356 64 L356 63 L356 62 L356 61 L356 61 L356 60 L355 60 L355 59 L355 58 L354 58 L354 57 L353 57 L353 57 L352 57 L352 56 L352 56 L352 55 L351 55 L351 54 L350 54 L350 53 L349 53 L348 53 L348 53 L348 53 L348 52 L347 52 L346 52 L345 52 L345 51 L344 51 L344 51 L343 50 L342 50 L341 50 L341 49 L340 49 L340 49 L339 49 L338 49 L337 49 L337 49 L336 49 L336 49 L335 49 L334 49 L333 49 L332 49 L332 48 L332 48 L331 48 L330 48 L329 48 L328 48 L328 48 L327 48 L326 48 L325 48 L324 48 L324 48 L323 48 L322 48 L321 48 L320 48 L320 48 L319 48 L318 48 L318 49 L317 49 L316 49 L316 49 L316 49 L315 49 L315 50 L314 50 L313 50 L313 49 L313 49 L314 49 L314 48 L315 48 L315 47 L316 47 L316 46 L316 45 L316 45 L316 45 L317 45 L317 44 L317 43 L318 43 L319 43 L319 42 L320 41 L320 41 L321 41 L322 41 L323 41 L323 41 L324 41 L324 41 L325 41 L326 41 L327 41 L328 41 L328 40 L328 40 L329 40 L330 40 L331 40 L332 40 L332 40 L333 40 L334 40 L335 40 L336 40 L336 40 L337 40 L338 40 L339 40 L340 41 L340 41 L341 41 L342 41 L343 41 L343 41 L344 41 L344 41 L345 41 L346 41 L347 41 L348 41 L348 42 L348 42 L349 42 L350 42 L350 43 L351 43 L352 43 L352 43 L352 44 L353 44 L354 44 L354 45 L355 45 L355 45 L356 45 L356 46 L356 46 L356 47 L357 47 L357 48 L358 48 L358 49 L359 49 L359 49 L360 49 L360 49 L360 50 L360 51 L361 51 L361 52 L362 52 L362 53 L363 53 L363 53 L363 54 L364 54 L364 55 L364 55 L364 56 L364 57 L365 57 L365 57 L365 58 L366 58 L366 59 L366 60 L366 61 L366 61 L366 62 L366 63 L367 63 L367 64 L367 65 L367 65 L367 66 L367 67 L367 68 L367 69 L367 69 L367 70 L367 71 L367 72 L366 72 L366 73 L365 73 L365 73 L364 73 L364 74 L364 74 L364 75 L364 74 L363 73 L363 73 L362 72 L362 71 L361 70 L361 69 L361 69 L360 69 L360 68 L360 67 L360 67 L360 66 L360 65 L359 65 L359 65 L359 64 L358 64 L358 63 L358 62 L357 62 L356 62 L356 61 L356 61 L355 61 L358 68"],
  ["M257 93 L257 93 L256 93 L256 93 L256 93 L255 93 L255 92 L254 92 L253 92 L253 91 L252 91 L252 90 L252 90 L251 90 L250 90 L250 89 L249 89 L249 89 L248 89 L248 88 L248 88 L248 87 L248 86 L247 86 L247 85 L246 85 L246 85 L246 84 L245 84 L245 83 L245 82 L244 82 L244 81 L244 81 L244 81 L244 80 L244 79 L244 78 L243 78 L243 77 L242 77 L241 77 L241 77 L240 77 L240 77 L240 76 L239 76 L238 76 L237 76 L236 76 L236 76 L236 76 L237 76 L237 75 L238 75 L239 74 L240 74 L240 73 L240 73 L241 73 L241 73 L242 73 L242 72 L243 72 L243 71 L244 71 L244 71 L245 71 L246 71 L247 71 L248 71 L248 71 L249 71 L250 71 L251 71 L252 71 L252 71 L253 71 L254 71 L255 71 L255 70 L256 70 L256 70 L257 70 L257 69 L258 69 L259 69 L260 69 L260 69 L260 69 L260 68 L261 68 L262 68 L262 67 L262 66 L263 66 L263 65 L264 65 L264 65 L264 65 L264 64 L265 64 L265 63 L266 63 L266 62 L267 62 L268 62 L268 62 L269 62 L269 63 L270 63 L271 63 L271 64 L272 64 L272 64 L273 64 L273 65 L274 65 L275 65 L276 65 L276 65 L277 65 L278 65 L279 65 L280 65 L280 65 L281 65 L282 65 L282 65 L282 66 L282 67 L282 68 L282 69 L282 69 L282 70 L282 71 L281 71 L281 72 L281 73 L281 73 L280 73 L280 74 L280 74 L280 75 L279 75 L279 76 L279 77 L278 77 L278 77 L277 77 L277 78 L277 79 L277 80 L277 81 L277 81 L276 81 L276 82 L276 83 L276 84 L276 85 L276 85 L276 86 L276 87 L276 88 L276 89 L276 89 L276 90 L276 91 L276 92 L276 93 L276 93 L276 93 L275 93 L274 93 L273 93 L272 93 L272 93 L272 94 L271 94 L270 94 L269 94 L268 94 L268 94 L267 94 L266 94 L265 94 L265 93 L264 93 L264 93 L264 93 L263 93 L262 93 L262 92 L261 92 L261 91 L260 91 L260 90 L260 90 L259 90 L258 90 L257 90 L256 90 L256 90 L255 90 L254 90 L253 90 L252 90 L257 93"]
])
const svgObjects = ref([]);
for (let i = 0; i < svgData.value.length; i++) {
  svgObjects.value.push(new SVGData(svgData.value[i], false));
}
const imageSize = ref({ left: 0, top: 0, width: 0, height: 0, realWidth: 0, realHeight: 0, xScale: 1, yScale: 1 });
const imgRef = ref(null);
const activeSVGPaths = computed(() => {
  return svgObjects.value.filter(svgObj => svgObj.isOn).map(svgObj => svgObj.svgPath)
});
console.log(activeSVGPaths)
const visible = ref(false);
const onMousesvg = (index) => {
  svgObjects.value[index].toggle();
  visible.value = true;
};
const outMousesvg = (index) => {
  svgObjects.value[index].toggle();
  visible.value = false;
};

const adjustImageSize = () => {
  const imgElement = imgRef.value;
  if (imgElement) {
    // 如果图片已加载完成，则直接计算尺寸
    if (imgElement.complete) {
      calculateImageSize(imgElement);
    } else {
      // 否则，设置onload监听器等待图片加载完成
      imgElement.onload = () => {
        calculateImageSize(imgElement);
      };
    }
  }
};
const calculateImageSize = (img) => {
  imageSize.value = {
    width: img.offsetWidth,
    height: img.offsetHeight,
    realWidth: img.naturalWidth,
    realHeight: img.naturalHeight,
    xScale: img.offsetWidth / img.naturalWidth,
    yScale: img.offsetHeight / img.naturalHeight,
    left: img.offsetLeft,
    top: img.offsetTop
  };
};
</script>

<template>
  <div class="container" :style="{ position: 'relative', width: '500px', height: '500px' }">
    <!-- 渲染图片 -->
    <img ref="imgRef" :src="image_url" alt="..." width="100%" height="100%" />
    <!-- 渲染SVG，根据imageSize进行缩放和定位 -->
    <el-tooltip :visible="visible">
      <svg :width="imageSize.width" :height="imageSize.height" :view-box="`0 0 ${imageSize.width} ${imageSize.height}`"
        xmlns="http://www.w3.org/2000/svg"
        :style="{ position: 'absolute', left: `${imageSize.left}px`, top: `${imageSize.top}px` }">
        <path v-for="(path, index) in activeSVGPaths" :key="index" :d="path" stroke="black" fill="none"
          stroke-width="2">
        </path>
        <path v-for="(path, index) in svgData" :key="`overlay-${index}`" :d="path" fill="transparent" fill-opacity="0"
          style="cursor: pointer;" @mouseover="onMousesvg(index)" @mouseout="outMousesvg(index)"></path>
      </svg>
    </el-tooltip>
  </div>
</template>

<style>
.container {
  display: flex;
  justify-content: center;
  align-items: center;
}
</style>